<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Management - Nanny Admin</title>
  
  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/admin.css">
  <link rel="stylesheet" href="css/global-search.css">
  <link rel="stylesheet" href="css/modal-override.css?v=6">
  
  <!-- Meta tags -->
  <meta name="description" content="Memory management for compassionate AI companion system">
  <meta name="theme-color" content="#6366f1">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><g transform='translate(50,50) scale(1.5)'><path d='M12 2C8.5 2 6 4.5 6 7.5C6 8.2 6.1 8.9 6.3 9.5C5.8 9.3 5.3 9.2 4.8 9.2C3.8 9.2 3 10 3 11C3 12 3.8 12.8 4.8 12.8C5.3 12.8 5.8 12.7 6.3 12.5C6.5 12.8 6.8 13.1 7.1 13.3C7.5 13.6 8 13.8 8.5 13.9V14.5C8.5 15.3 9.2 16 10 16H14C14.8 16 15.5 15.3 15.5 14.5V13.9C16 13.8 16.5 13.6 16.9 13.3C17.2 13.1 17.5 12.8 17.7 12.5C18.2 12.7 18.7 12.8 19.2 12.8C20.2 12.8 21 12 21 11C21 10 20.2 9.2 19.2 9.2C18.7 9.2 18.2 9.3 17.7 9.5C17.9 8.9 18 8.2 18 7.5C18 4.5 15.5 2 12 2Z' fill='white'/><ellipse cx='12' cy='10' rx='4.5' ry='4' fill='%236366f1'/><path d='M9 14.5L10.5 15.5L12 15L13.5 15.5L15 14.5' stroke='white' stroke-width='0.5' fill='none'/><path d='M8 16C7.5 16 7 16.5 7 17V20C7 20.5 7.5 21 8 21H16C16.5 21 17 20.5 17 20V17C17 16.5 16.5 16 16 16' fill='white'/><path d='M10 17H14V20.5C14 20.8 13.8 21 13.5 21H10.5C10.2 21 10 20.8 10 20.5V17Z' fill='%236366f1'/><ellipse cx='6.5' cy='18' rx='1.5' ry='2.5' transform='rotate(-20 6.5 18)' fill='white'/><ellipse cx='17.5' cy='18' rx='1.5' ry='2.5' transform='rotate(20 17.5 18)' fill='white'/></g></svg>">
  
  <!-- Prevent FOUC -->
  <style>
    body { visibility: hidden; }
    .js body { visibility: visible; }
    
    /* Memory management page styles */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-8);
      gap: var(--space-6);
    }
    
    .page-title-section {
      flex: 1;
    }
    
    .page-title {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 var(--space-2);
    }
    
    .page-icon {
      width: 32px;
      height: 32px;
      color: var(--color-primary);
    }
    
    .page-description {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
    }
    
    .page-actions {
      display: flex;
      gap: var(--space-3);
      flex-shrink: 0;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }
    
    
    .search-filter-container {
      display: flex;
      gap: var(--space-3);
      align-items: center;
    }
    
    .search-input-wrapper {
      position: relative;
    }
    
    .search-input-wrapper .search-icon {
      position: absolute;
      left: var(--space-3);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      pointer-events: none;
    }
    
    .search-input-wrapper .form-input {
      padding-left: calc(var(--space-3) + 16px + var(--space-2));
      min-width: 250px;
    }
    
    .memory-table-container {
      overflow-x: auto;
    }
    
    .category-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }
    
    .category-badge.family { background: rgba(34, 197, 94, 0.1); color: rgb(34, 197, 94); }
    .category-badge.preferences { background: rgba(59, 130, 246, 0.1); color: rgb(59, 130, 246); }
    .category-badge.medical { background: rgba(239, 68, 68, 0.1); color: rgb(239, 68, 68); }
    .category-badge.personal { background: rgba(168, 85, 247, 0.1); color: rgb(168, 85, 247); }
    .category-badge.activities { background: rgba(251, 191, 36, 0.1); color: rgb(251, 191, 36); }
    .category-badge.other { background: rgba(107, 114, 128, 0.1); color: rgb(107, 114, 128); }
    
    .content-preview {
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--text-secondary);
    }
    
    /* Memory form styles */
    .memory-form .form-group {
      margin-bottom: var(--space-6);
    }
    
    .memory-form .form-help {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: var(--space-1);
    }
    
    .memory-details .detail-group {
      margin-bottom: var(--space-4);
    }
    
    .memory-details .detail-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: var(--space-1);
    }
    
    .memory-details .detail-value {
      color: var(--text-primary);
      line-height: 1.5;
    }
    
    /* Table action buttons */
    .action-buttons {
      display: flex;
      gap: var(--space-1);
    }
    
    .action-buttons .btn {
      padding: var(--space-1) var(--space-2);
    }
    
    /* Loading and error states */
    .loading-container, .error-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-8);
      text-align: center;
    }
    
    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border-primary);
      border-top: 3px solid var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--space-4);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text, .error-text {
      color: var(--text-secondary);
      margin-bottom: var(--space-4);
    }
    
    .error-icon {
      width: 48px;
      height: 48px;
      color: var(--color-danger);
      margin-bottom: var(--space-4);
    }
    
    .error-icon svg {
      width: 100%;
      height: 100%;
    }
    
    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-8);
      text-align: center;
    }
    
    .empty-icon {
      width: 64px;
      height: 64px;
      color: var(--text-secondary);
      margin-bottom: var(--space-4);
    }
    
    .empty-icon svg {
      width: 100%;
      height: 100%;
    }
    
    .empty-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }
    
    .empty-description {
      color: var(--text-secondary);
      margin-bottom: var(--space-6);
      max-width: 400px;
    }
    
    /* Pagination styles */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-6) 0;
      border-top: 1px solid var(--border-primary);
      margin-top: var(--space-6);
    }
    
    .pagination-info {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    
    .page-numbers {
      display: flex;
      gap: var(--space-1);
    }
    
    .page-number {
      min-width: 32px;
      height: 32px;
      padding: 0 var(--space-2);
      border: 1px solid var(--border-primary);
      background: var(--bg-primary);
      color: var(--text-primary);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .page-number:hover:not(:disabled) {
      background: var(--bg-secondary);
      border-color: var(--color-primary);
    }
    
    .page-number.active {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }
    
    .page-number:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Sort table headers */
    th.sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    
    th.sortable:hover {
      background: var(--bg-secondary);
    }
    
    th.sortable .sort-icon {
      opacity: 0.3;
      transition: opacity 0.2s ease;
    }
    
    th.sortable:hover .sort-icon,
    th.sortable.sorted-asc .sort-icon,
    th.sortable.sorted-desc .sort-icon {
      opacity: 1;
    }
    
    th.sortable.sorted-desc .sort-icon {
      transform: rotate(180deg);
    }

    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .page-actions {
        justify-content: flex-start;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .search-filter-container {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-input-wrapper .form-input {
        min-width: auto;
      }
      
      .pagination-container {
        flex-direction: column;
        gap: var(--space-4);
        align-items: center;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
  <script>document.documentElement.className = 'js';</script>
</head>
<body data-page="memories">
  <!-- Admin Layout Container -->
  <div class="admin-layout">
    <!-- Main Content -->
    <main class="admin-main" role="main">
        <!-- Memory Management Content -->
      <div class="page-header">
        <div class="page-title-section">
          <h1 class="page-title">
            <svg class="page-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            Memory Management
          </h1>
          <p class="page-description">
            Manage the AI companion's memory system to ensure personalized and compassionate interactions
          </p>
        </div>
        
        <div class="page-actions">
          <button id="add-memory-btn" class="btn btn-primary">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Memory
          </button>
          <button id="refresh-memories" class="btn btn-outline">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Refresh
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="total-memories">--</div>
            <div class="stat-label">Total Memories</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="memory-categories">--</div>
            <div class="stat-label">Categories Used</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="last-updated">--</div>
            <div class="stat-label">Last Updated</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="recent-access">--</div>
            <div class="stat-label">Recently Accessed</div>
          </div>
        </div>
      </div>

      <!-- Memory Table Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title-section">
            <h2 class="card-title">Stored Memories</h2>
            <p class="card-description">View and manage all memories that help personalize conversations</p>
          </div>
          
          <div class="card-actions">
            <!-- Search and Filter Controls -->
            <div class="search-filter-container">
              <div class="search-input-wrapper">
                <input 
                  type="text" 
                  id="memory-search" 
                  class="form-input" 
                  placeholder="Search memories..."
                  aria-label="Search memories"
                >
                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </div>
              
              <select id="category-filter" class="form-select" aria-label="Filter by category">
                <option value="">All Categories</option>
                <option value="family">Family</option>
                <option value="preferences">Preferences</option>
                <option value="medical">Medical</option>
                <option value="personal">Personal</option>
                <option value="activities">Activities</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="card-content">
          <!-- Loading State -->
          <div id="memories-loading" class="loading-container" style="display: none;">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading memories...</div>
          </div>
          
          <!-- Error State -->
          <div id="memories-error" class="error-container" style="display: none;">
            <div class="error-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 19c-.77.833.192 2.5 1.732 2.5z"/>
              </svg>
            </div>
            <div class="error-text">Failed to load memories</div>
            <button id="retry-loading" class="btn btn-outline btn-sm">Try Again</button>
          </div>
          
          <!-- Empty State -->
          <div id="memories-empty" class="empty-state" style="display: none;">
            <div class="empty-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
            </div>
            <div class="empty-title">No memories stored</div>
            <div class="empty-description">Start building the AI's memory by adding personal information and preferences</div>
            <button id="add-first-memory" class="btn btn-primary">Add First Memory</button>
          </div>
          
          <!-- Memory Table -->
          <div id="memory-table-container" class="table-container">
            <table id="memory-table" class="table">
              <thead>
                <tr>
                  <th class="sortable" data-sort="key">
                    Memory Key
                    <svg class="sort-icon" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"/>
                    </svg>
                  </th>
                  <th class="sortable" data-sort="category">
                    Category
                    <svg class="sort-icon" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"/>
                    </svg>
                  </th>
                  <th>Content Preview</th>
                  <th class="sortable" data-sort="last_accessed">
                    Last Accessed
                    <svg class="sort-icon" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"/>
                    </svg>
                  </th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="memory-table-body">
                <!-- Dynamic content -->
              </tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          <div id="memory-pagination" class="pagination-container" style="display: none;">
            <div class="pagination-info">
              <span id="pagination-text">Showing 1-10 of 0 memories</span>
            </div>
            <div class="pagination-controls">
              <button id="prev-page" class="btn btn-outline btn-sm" disabled>
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Previous
              </button>
              <div id="page-numbers" class="page-numbers">
                <!-- Dynamic page numbers -->
              </div>
              <button id="next-page" class="btn btn-outline btn-sm" disabled>
                Next
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Mobile Sidebar Overlay -->
    <div class="layout-overlay"></div>
  </div>

  <!-- JavaScript -->
  <script src="js/admin.js"></script>
  <script type="module" src="js/template-loader.js"></script>
  <script type="module" src="js/global-search.js"></script>
  <script type="module" src="js/memories.js"></script>
  
  <!-- Set current year -->
  <script>
    document.getElementById('current-year').textContent = new Date().getFullYear();
  </script>
</body>
</html>