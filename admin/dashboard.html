<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Nanny Admin</title>
  
  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/admin.css">
  
  <!-- Meta tags -->
  <meta name="description" content="Administrative dashboard for compassionate AI companion">
  <meta name="theme-color" content="#6366f1">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><g transform='translate(50,50) scale(1.5)'><path d='M12 2C8.5 2 6 4.5 6 7.5C6 8.2 6.1 8.9 6.3 9.5C5.8 9.3 5.3 9.2 4.8 9.2C3.8 9.2 3 10 3 11C3 12 3.8 12.8 4.8 12.8C5.3 12.8 5.8 12.7 6.3 12.5C6.5 12.8 6.8 13.1 7.1 13.3C7.5 13.6 8 13.8 8.5 13.9V14.5C8.5 15.3 9.2 16 10 16H14C14.8 16 15.5 15.3 15.5 14.5V13.9C16 13.8 16.5 13.6 16.9 13.3C17.2 13.1 17.5 12.8 17.7 12.5C18.2 12.7 18.7 12.8 19.2 12.8C20.2 12.8 21 12 21 11C21 10 20.2 9.2 19.2 9.2C18.7 9.2 18.2 9.3 17.7 9.5C17.9 8.9 18 8.2 18 7.5C18 4.5 15.5 2 12 2Z' fill='white'/><ellipse cx='12' cy='10' rx='4.5' ry='4' fill='%236366f1'/><path d='M9 14.5L10.5 15.5L12 15L13.5 15.5L15 14.5' stroke='white' stroke-width='0.5' fill='none'/><path d='M8 16C7.5 16 7 16.5 7 17V20C7 20.5 7.5 21 8 21H16C16.5 21 17 20.5 17 20V17C17 16.5 16.5 16 16 16' fill='white'/><path d='M10 17H14V20.5C14 20.8 13.8 21 13.5 21H10.5C10.2 21 10 20.8 10 20.5V17Z' fill='%236366f1'/><ellipse cx='6.5' cy='18' rx='1.5' ry='2.5' transform='rotate(-20 6.5 18)' fill='white'/><ellipse cx='17.5' cy='18' rx='1.5' ry='2.5' transform='rotate(20 17.5 18)' fill='white'/></g></svg>">
  
  <!-- Prevent FOUC -->
  <style>
    body { visibility: hidden; }
    .js body { visibility: visible; }
  </style>
  <script>document.documentElement.className = 'js';</script>
</head>
<body data-page="dashboard">
  <!-- Admin Layout Container -->
  <div class="admin-layout">
    <!-- Main Content -->
    <main class="admin-main" role="main">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-content">
          <div class="header-left">
            <h1 class="page-title">Dashboard</h1>
            <p class="page-description">Compassionate care insights and emotional wellness monitoring</p>
          </div>
          <div class="header-actions">
            <div class="time-range-selector">
              <span id="lastUpdated" class="last-updated">Updated: --</span>
              <select id="timeRange" class="time-range-select">
                <option value="today">Today</option>
                <option value="7" selected>Last 7 Days</option>
                <option value="30">Last 30 Days</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Dashboard Content -->
      <div class="page-content">
        <!-- Critical Alerts Section -->
        <div id="critical-alerts" class="critical-alerts-container" style="display: none;"></div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #4338ca, #3730a3); color: #a5b4fc;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="callsToday">--</div>
              <div class="stat-label">
                Conversations Today
                <div class="timezone-info" id="timezoneInfo" style="font-size: 10px; opacity: 0.6; margin-top: 2px;"></div>
              </div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #e11d48, #be185d); color: #fca5a5;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="avgAnxiety">--</div>
              <div class="stat-label">Average Anxiety Level</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #059669, #047857); color: #6ee7b7;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="avgComfort">--</div>
              <div class="stat-label">Comfort Level</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #d97706, #b45309); color: #fcd34d;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="alertCount">--</div>
              <div class="stat-label">Active Alerts</div>
            </div>
          </div>
        </div>

        <!-- Emotional Trends Chart -->
        <div class="glass-card chart-container">
          <div class="chart-header">
            <h3>Emotional Trends</h3>
            <p class="chart-subtitle">Daily averages for anxiety, agitation, confusion, and comfort levels</p>
          </div>
          <div class="chart-wrapper">
            <canvas id="emotionalTrendsChart"></canvas>
          </div>
          <div class="chart-loading" id="chartLoading">
            <div class="loading-spinner"></div>
            <span>Loading emotional trend data...</span>
          </div>
        </div>

        <!-- Recent Conversations and Care Indicators -->
        <div class="dashboard-grid">
          <!-- Recent Conversations -->
          <div class="glass-card conversations-panel">
            <div class="panel-header">
              <h3>Recent Conversations</h3>
              <p class="panel-subtitle">Last 5 interactions with emotional indicators</p>
            </div>
            <div class="conversations-list" id="recentConversations">
              <div class="loading-state">
                <div class="loading-spinner"></div>
                <span>Loading conversations...</span>
              </div>
            </div>
          </div>

          <!-- Care Indicators Panel -->
          <div class="glass-card care-indicators-panel">
            <div class="panel-header">
              <h3>Care Indicators</h3>
              <p class="panel-subtitle">Important mentions from conversations</p>
            </div>
            <div class="care-indicators" id="careIndicators">
              <div class="loading-state">
                <div class="loading-spinner"></div>
                <span>Loading care indicators...</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
          <a href="/admin/conversations" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            View All Conversations
          </a>
          <a href="/admin/memories" class="btn btn-secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h4m6-6h4a2 2 0 0 1 2 2v3c0 1.1-.9 2-2 2h-4m-6-6V9a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 0V9a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Manage Memories
          </a>
        </div>
      </div>
    </main>
  </div>

  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- JavaScript -->
  <script src="js/template-loader.js" type="module"></script>
  <script src="js/admin.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>

<style>
/* Dashboard Specific Styles */
.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-6);
  padding: var(--space-4);
}

/* Header layout styles */
.page-header {
  margin-bottom: var(--space-8);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  width: 100%;
  gap: var(--space-4);
}

.header-left {
  flex: 1;
}

.header-actions {
  flex-shrink: 0;
  display: flex;
  align-items: flex-end;
}

.time-range-selector {
  display: flex;
  flex-direction: column !important;
  align-items: flex-end;
  gap: var(--space-2);
  text-align: right;
}

.time-range-selector .last-updated {
  display: block;
  margin-bottom: var(--space-2);
}

.time-range-selector .time-range-select {
  display: block;
}

.time-range-selector label {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--text-secondary);
}

.time-range-select {
  padding: var(--space-2) var(--space-3);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--text-sm);
}

.last-updated {
  font-size: var(--text-xs);
  color: var(--text-tertiary);
  margin-left: var(--space-4);
}

/* Critical Alerts */
.critical-alerts-container {
  margin-bottom: var(--space-6);
}

.critical-alert {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: var(--radius-lg);
  padding: var(--space-4);
  margin-bottom: var(--space-3);
  display: flex;
  align-items: flex-start;
  gap: var(--space-3);
}

.critical-alert.warning {
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
  border-color: rgba(245, 158, 11, 0.3);
}

.alert-icon {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  color: var(--color-error);
}

.critical-alert.warning .alert-icon {
  color: var(--color-warning);
}

.alert-content h4 {
  margin: 0 0 var(--space-1) 0;
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-error);
}

.critical-alert.warning .alert-content h4 {
  color: var(--color-warning);
}

.alert-content p {
  margin: 0 0 var(--space-2) 0;
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

.alert-action {
  font-size: var(--text-xs);
  color: var(--text-tertiary);
  font-style: italic;
}

/* Chart Container */
.chart-container {
  margin-bottom: var(--space-6);
  padding: var(--space-6);
}

.chart-header {
  margin-bottom: var(--space-4);
}

.chart-header h3 {
  margin: 0 0 var(--space-1) 0;
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--text-primary);
}

.chart-subtitle {
  margin: 0;
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

.chart-wrapper {
  position: relative;
  height: 300px;
  margin-bottom: var(--space-4);
}

.chart-loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  gap: var(--space-3);
  color: var(--text-secondary);
  font-size: var(--text-sm);
}

/* Dashboard Grid */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-4);
  margin-bottom: var(--space-6);
}

/* Conversations Panel */
.conversations-panel,
.care-indicators-panel {
  padding: var(--space-6);
}

.panel-header {
  margin-bottom: var(--space-4);
}

.panel-header h3 {
  margin: 0 0 var(--space-1) 0;
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--text-primary);
}

.panel-subtitle {
  margin: 0;
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

.conversations-list {
  overflow: hidden;
}

.conversation-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-2);
  background: var(--bg-secondary);
  transition: all var(--transition-fast);
}

.conversation-item:hover {
  background: var(--bg-tertiary);
}

.emotional-state {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.emotional-state svg {
  width: 24px;
  height: 24px;
  fill: white;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
}

.emotional-state.comfortable { background: var(--color-success); }
.emotional-state.neutral { background: var(--color-warning); }
.emotional-state.distressed { background: var(--color-error); }

.conversation-details {
  flex: 1;
  min-width: 0;
}

.conversation-title {
  font-size: var(--text-base);
  color: var(--text-primary);
  font-weight: 500;
  line-height: 1.5;
  margin-bottom: var(--space-1);
}

.conversation-summary {
  font-size: var(--text-xs);
  color: var(--text-secondary);
  line-height: 1.4;
}
.emotional-levels {
  display: flex;
  gap: var(--space-1);
  flex-wrap: wrap;
}
.level {
  font-size: var(--text-xs);
  font-weight: 600;
  padding: 2px var(--space-2);
  border-radius: var(--radius-sm);
  min-width: 20px;
  text-align: center;
}
.level.anxiety {
  background: rgba(239, 68, 68, 0.15);
  color: #dc2626;
  border: 1px solid rgba(239, 68, 68, 0.3);
}
.level.comfort {
  background: rgba(16, 185, 129, 0.15);
  color: #059669;
  border: 1px solid rgba(16, 185, 129, 0.3);
}
.level.agitation {
  background: rgba(245, 158, 11, 0.15);
  color: #d97706;
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.care-indicators {
  /* Remove invalid space-y property */
}

.care-indicator {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  border-radius: var(--radius-md);
  background: var(--bg-secondary);
  margin-bottom: var(--space-2);
  transition: all var(--transition-fast);
}

.care-indicator:hover {
  background: var(--bg-tertiary);
}

.care-indicator:last-child {
  margin-bottom: 0;
}

.indicator-icon {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

.indicator-count {
  font-weight: var(--font-semibold);
  color: var(--text-primary);
}

.indicator-label {
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

/* Loading States */
.loading-state {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
  padding: var(--space-8);
  color: var(--text-secondary);
  font-size: var(--text-sm);
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--bg-tertiary);
  border-top: 2px solid var(--color-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Quick Actions */
.quick-actions {
  display: flex;
  gap: var(--space-4);
  justify-content: center;
  flex-wrap: wrap;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .dashboard-header {
    flex-direction: column;
    gap: var(--space-3);
    align-items: stretch;
  }
  
  .overview-cards {
    grid-template-columns: 1fr;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  
  .chart-wrapper {
    height: 250px;
  }
  
  .quick-actions {
    flex-direction: column;
  }
}
</style>